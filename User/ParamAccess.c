/*******************************************************************************
* 文件名	: ParamAccess.c
* 作者		: Yang
* 版本		: V1.0.0
* 创建时间	: 10/13/2014
* 描述		: 系统参数的 存储 与 读取
*******************************************************************************/

/* Includes ------------------------------------------------------------------*/
#include "ParamAccess.h"
/*Data*/
extern U16 OCV_SOC[1024];

/* Function ------------------------------------------------------------------*/

U16 Read_Store_State(void)
{
	U32 addr;
	U16 data;

	addr=STATE_ADDR;
   	data=FLASH_ReadHalfWord(addr);
	data=data;
	return data;
}

void Store_State(U16 data)
{
	U32 addr;

	addr=STATE_ADDR;
   	FLASH_WriteHalfWord(addr,data);
}

void Store_Ri(U16* pdata,U16 length)
{
	U16 data;

	FLASH_Write_U16(TEMP_RI_ADDR,pdata,length);

	/*写入存储状态*/
	data=Read_Store_State();	
	data=data | (0x01);
	Store_State(data);	
}

U16 Read_Ri(U16 temp,U16 soc)
{
	U16 data;
	U32 addr;

	addr=TEMP_RI_ADDR+2*soc;
	if(temp>=200)
	{
		data=FLASH_ReadHalfWord(addr);	
	}
	
	return data;	
}

void Store_OCV_SOC(U16 ocv,U16 soc)
{
//	U32 ocv_addr;
	U16 data;
	
	/*写入存储状态*/
	data=Read_Store_State();	
	data=data | (0x01<<1);
	Store_State(data);	
}

U16 Read_OCV_SOC(U16 soc) //ocv单位mv
{
	U16 data;
//	F64 ocv_V;
	F64 soc_1;
	data=soc_1*10;

	return data;
}

void Store_Qmax(U16 qmax)
{
	U16 data;
	FLASH_WriteHalfWord(Qmax_ADDR,qmax);

	/*写入存储状态*/
	data=Read_Store_State();	
	data=data | (0x01<<2);
	Store_State(data);	
}

U16 Read_Qmax(void)
{
	U32 addr;
	U16 data;

 	addr=Qmax_ADDR;
	data=FLASH_ReadHalfWord(addr);

	return (U16)data;
}

void Store_Age(U16 age)
{
	U16 data;

	FLASH_WriteHalfWord(AEG_ADDR,age);

	/*写入存储状态*/
	data=Read_Store_State();	
	data=data | (0x01<<3);
	Store_State(data);	
}

U16 Read_Age(void)
{
	U16 data;

	data=FLASH_ReadHalfWord(AEG_ADDR);

	return data;
}

/*OCV_SOC */
extern U16 OCV_SOC[1024];

U16 SOCtoOCV(U16 soc)	   //soc 单位0.1%
{
	U16 ocv;

	ocv=OCV_SOC[1000-soc];
	return ocv;
}

U16 OCVtoSOC(U16 ocv)	  //ocv单位mV
{
	U16 i;
	U16 start;
	U16 end;

	start=0;
	end=1024;
	while(1)
	{
		i=(start+end)/2;

		if(ocv>OCV_SOC[i])
		{
			end=i;
		}
		else
		{
			start=i;
		}
		if((end<=start) || ((end-start)==1))
		{
			break;
		}
	}

	return (1000-i);
}

/*OCV_SOC 数据表*/
U16 OCV_SOC[1024]=
{
4198 	,	 //SOC 100.0%
4197 	,	 //SOC 99.9%
4196 	,	 //SOC 99.8%
4194 	,
4193 	,
4192 	,
4190 	,
4189 	,
4187 	,
4186 	,
4185 	,
4183 	,
4182 	,
4181 	,
4179 	,
4178 	,
4176 	,
4175 	,
4174 	,
4172 	,
4171 	,
4170 	,
4168 	,
4167 	,
4166 	,
4164 	,
4163 	,
4162 	,
4160 	,
4159 	,
4158 	,
4156 	,
4155 	,
4154 	,
4153 	,
4151 	,
4150 	,
4149 	,
4148 	,
4146 	,
4145 	,
4144 	,
4143 	,
4142 	,
4140 	,
4139 	,
4138 	,
4137 	,
4136 	,
4135 	,
4133 	,
4132 	,
4131 	,
4130 	,
4129 	,
4128 	,
4127 	,
4126 	,
4125 	,
4124 	,
4123 	,
4122 	,
4121 	,
4120 	,
4119 	,
4117 	,
4116 	,
4115 	,
4114 	,
4113 	,
4113 	,
4112 	,
4111 	,
4110 	,
4109 	,
4108 	,
4107 	,
4106 	,
4105 	,
4104 	,
4103 	,
4102 	,
4101 	,
4100 	,
4099 	,
4098 	,
4097 	,
4096 	,
4096 	,
4095 	,
4094 	,
4093 	,
4092 	,
4091 	,
4090 	,
4089 	,
4088 	,
4087 	,
4087 	,
4086 	,
4085 	,
4084 	,
4083 	,
4082 	,
4081 	,
4080 	,
4079 	,
4078 	,
4078 	,
4077 	,
4076 	,
4075 	,
4074 	,
4073 	,
4072 	,
4071 	,
4070 	,
4069 	,
4068 	,
4068 	,
4067 	,
4066 	,
4065 	,
4064 	,
4063 	,
4062 	,
4061 	,
4060 	,
4059 	,
4058 	,
4057 	,
4056 	,
4055 	,
4055 	,
4054 	,
4053 	,
4052 	,
4051 	,
4050 	,
4049 	,
4048 	,
4047 	,
4046 	,
4045 	,
4044 	,
4043 	,
4042 	,
4041 	,
4040 	,
4039 	,
4038 	,
4037 	,
4036 	,
4035 	,
4034 	,
4033 	,
4032 	,
4031 	,
4030 	,
4029 	,
4028 	,
4027 	,
4026 	,
4025 	,
4024 	,
4023 	,
4022 	,
4021 	,
4020 	,
4019 	,
4018 	,
4017 	,
4016 	,
4015 	,
4014 	,
4013 	,
4012 	,
4011 	,
4010 	,
4009 	,
4008 	,
4006 	,
4005 	,
4004 	,
4003 	,
4002 	,
4001 	,
4000 	,
3999 	,
3998 	,
3997 	,
3996 	,
3995 	,
3994 	,
3993 	,
3992 	,
3991 	,
3990 	,
3989 	,
3988 	,
3987 	,
3986 	,
3985 	,
3984 	,
3983 	,
3982 	,
3981 	,
3980 	,
3979 	,
3978 	,
3977 	,
3976 	,
3975 	,
3974 	,
3973 	,
3972 	,
3971 	,
3970 	,
3969 	,
3968 	,
3967 	,
3966 	,
3965 	,
3964 	,
3963 	,
3962 	,
3961 	,
3960 	,
3959 	,
3958 	,
3957 	,
3956 	,
3955 	,
3955 	,
3954 	,
3953 	,
3952 	,
3951 	,
3950 	,
3949 	,
3948 	,
3947 	,
3946 	,
3946 	,
3945 	,
3944 	,
3943 	,
3942 	,
3941 	,
3940 	,
3940 	,
3939 	,
3938 	,
3937 	,
3936 	,
3936 	,
3935 	,
3934 	,
3933 	,
3932 	,
3932 	,
3931 	,
3930 	,
3929 	,
3928 	,
3928 	,
3927 	,
3926 	,
3925 	,
3925 	,
3924 	,
3923 	,
3923 	,
3922 	,
3921 	,
3921 	,
3920 	,
3919 	,
3918 	,
3918 	,
3917 	,
3916 	,
3916 	,
3915 	,
3915 	,
3914 	,
3913 	,
3913 	,
3912 	,
3911 	,
3911 	,
3910 	,
3910 	,
3909 	,
3908 	,
3908 	,
3907 	,
3907 	,
3906 	,
3905 	,
3905 	,
3904 	,
3904 	,
3903 	,
3903 	,
3902 	,
3902 	,
3901 	,
3901 	,
3900 	,
3900 	,
3899 	,
3899 	,
3898 	,
3898 	,
3897 	,
3897 	,
3896 	,
3896 	,
3895 	,
3895 	,
3894 	,
3894 	,
3893 	,
3893 	,
3892 	,
3892 	,
3891 	,
3891 	,
3891 	,
3890 	,
3890 	,
3889 	,
3889 	,
3888 	,
3888 	,
3888 	,
3887 	,
3887 	,
3886 	,
3886 	,
3885 	,
3885 	,
3885 	,
3884 	,
3884 	,
3883 	,
3883 	,
3883 	,
3882 	,
3882 	,
3881 	,
3881 	,
3881 	,
3880 	,
3880 	,
3879 	,
3879 	,
3879 	,
3878 	,
3878 	,
3878 	,
3877 	,
3877 	,
3876 	,
3876 	,
3876 	,
3875 	,
3875 	,
3874 	,
3874 	,
3874 	,
3873 	,
3873 	,
3872 	,
3872 	,
3872 	,
3871 	,
3871 	,
3870 	,
3870 	,
3870 	,
3869 	,
3869 	,
3868 	,
3868 	,
3868 	,
3867 	,
3867 	,
3866 	,
3866 	,
3865 	,
3865 	,
3865 	,
3864 	,
3864 	,
3863 	,
3863 	,
3862 	,
3862 	,
3862 	,
3861 	,
3861 	,
3860 	,
3860 	,
3859 	,
3859 	,
3858 	,
3858 	,
3858 	,
3857 	,
3857 	,
3856 	,
3856 	,
3855 	,
3855 	,
3854 	,
3854 	,
3853 	,
3853 	,
3852 	,
3852 	,
3851 	,
3851 	,
3850 	,
3850 	,
3849 	,
3849 	,
3848 	,
3848 	,
3847 	,
3847 	,
3846 	,
3846 	,
3845 	,
3845 	,
3844 	,
3843 	,
3843 	,
3842 	,
3842 	,
3841 	,
3841 	,
3840 	,
3840 	,
3839 	,
3838 	,
3838 	,
3837 	,
3837 	,
3836 	,
3836 	,
3835 	,
3834 	,
3834 	,
3833 	,
3833 	,
3832 	,
3832 	,
3831 	,
3830 	,
3830 	,
3829 	,
3829 	,
3828 	,
3827 	,
3827 	,
3826 	,
3825 	,
3825 	,
3824 	,
3824 	,
3823 	,
3822 	,
3822 	,
3821 	,
3821 	,
3820 	,
3819 	,
3819 	,
3818 	,
3817 	,
3817 	,
3816 	,
3816 	,
3815 	,
3814 	,
3814 	,
3813 	,
3812 	,
3812 	,
3811 	,
3811 	,
3810 	,
3809 	,
3809 	,
3808 	,
3807 	,
3807 	,
3806 	,
3806 	,
3805 	,
3804 	,
3804 	,
3803 	,
3802 	,
3802 	,
3801 	,
3801 	,
3800 	,
3799 	,
3799 	,
3798 	,
3798 	,
3797 	,
3796 	,
3796 	,
3795 	,
3795 	,
3794 	,
3794 	,
3793 	,
3792 	,
3792 	,
3791 	,
3791 	,
3790 	,
3790 	,
3789 	,
3788 	,
3788 	,
3787 	,
3787 	,
3786 	,
3786 	,
3785 	,
3785 	,
3784 	,
3784 	,
3783 	,
3783 	,
3782 	,
3782 	,
3781 	,
3781 	,
3780 	,
3780 	,
3779 	,
3779 	,
3778 	,
3778 	,
3777 	,
3777 	,
3776 	,
3776 	,
3776 	,
3775 	,
3775 	,
3774 	,
3774 	,
3773 	,
3773 	,
3773 	,
3772 	,
3772 	,
3772 	,
3771 	,
3771 	,
3770 	,
3770 	,
3770 	,
3769 	,
3769 	,
3769 	,
3768 	,
3768 	,
3768 	,
3767 	,
3767 	,
3767 	,
3766 	,
3766 	,
3766 	,
3766 	,
3765 	,
3765 	,
3765 	,
3765 	,
3764 	,
3764 	,
3764 	,
3764 	,
3763 	,
3763 	,
3763 	,
3763 	,
3763 	,
3762 	,
3762 	,
3762 	,
3762 	,
3762 	,
3762 	,
3761 	,
3761 	,
3761 	,
3761 	,
3761 	,
3761 	,
3761 	,
3760 	,
3760 	,
3760 	,
3760 	,
3760 	,
3760 	,
3760 	,
3760 	,
3760 	,
3759 	,
3759 	,
3759 	,
3759 	,
3759 	,
3759 	,
3759 	,
3759 	,
3759 	,
3759 	,
3759 	,
3759 	,
3759 	,
3759 	,
3759 	,
3759 	,
3759 	,
3759 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3758 	,
3757 	,
3757 	,
3757 	,
3757 	,
3757 	,
3757 	,
3757 	,
3757 	,
3757 	,
3757 	,
3757 	,
3757 	,
3756 	,
3756 	,
3756 	,
3756 	,
3756 	,
3756 	,
3756 	,
3756 	,
3755 	,
3755 	,
3755 	,
3755 	,
3755 	,
3754 	,
3754 	,
3754 	,
3754 	,
3754 	,
3753 	,
3753 	,
3753 	,
3753 	,
3752 	,
3752 	,
3752 	,
3752 	,
3751 	,
3751 	,
3751 	,
3750 	,
3750 	,
3750 	,
3749 	,
3749 	,
3749 	,
3748 	,
3748 	,
3748 	,
3747 	,
3747 	,
3746 	,
3746 	,
3746 	,
3745 	,
3745 	,
3744 	,
3744 	,
3743 	,
3743 	,
3742 	,
3742 	,
3741 	,
3741 	,
3740 	,
3740 	,
3739 	,
3739 	,
3738 	,
3738 	,
3737 	,
3737 	,
3736 	,
3736 	,
3735 	,
3734 	,
3734 	,
3733 	,
3732 	,
3732 	,
3731 	,
3731 	,
3730 	,
3729 	,
3729 	,
3728 	,
3727 	,
3727 	,
3726 	,
3725 	,
3725 	,
3724 	,
3723 	,
3723 	,
3722 	,
3721 	,
3720 	,
3720 	,
3719 	,
3718 	,
3718 	,
3717 	,
3716 	,
3715 	,
3715 	,
3714 	,
3713 	,
3712 	,
3712 	,
3711 	,
3710 	,
3710 	,
3709 	,
3708 	,
3707 	,
3707 	,
3706 	,
3705 	,
3704 	,
3704 	,
3703 	,
3702 	,
3702 	,
3701 	,
3700 	,
3699 	,
3699 	,
3698 	,
3697 	,
3697 	,
3696 	,
3695 	,
3695 	,
3694 	,
3693 	,
3693 	,
3692 	,
3691 	,
3691 	,
3690 	,
3689 	,
3689 	,
3688 	,
3688 	,
3687 	,
3686 	,
3686 	,
3685 	,
3685 	,
3684 	,
3684 	,
3683 	,
3683 	,
3682 	,
3682 	,
3681 	,
3681 	,
3680 	,
3680 	,
3679 	,
3679 	,
3678 	,
3678 	,
3677 	,
3677 	,
3677 	,
3676 	,
3676 	,
3675 	,
3675 	,
3675 	,
3674 	,
3674 	,
3674 	,
3673 	,
3673 	,
3672 	,
3672 	,
3672 	,
3671 	,
3671 	,
3671 	,
3670 	,
3670 	,
3670 	,
3669 	,
3669 	,
3669 	,
3668 	,
3668 	,
3668 	,
3667 	,
3667 	,
3667 	,
3666 	,
3666 	,
3665 	,
3665 	,
3664 	,
3664 	,
3663 	,
3663 	,
3662 	,
3662 	,
3661 	,
3661 	,
3660 	,
3659 	,
3658 	,
3658 	,
3657 	,
3656 	,
3655 	,
3654 	,
3653 	,
3652 	,
3651 	,
3650 	,
3648 	,
3647 	,
3646 	,
3644 	,
3642 	,
3641 	,
3639 	,
3637 	,
3635 	,
3633 	,
3631 	,
3629 	,
3627 	,
3624 	,
3622 	,
3619 	,
3616 	,
3613 	,
3610 	,
3607 	,
3603 	,
3600 	,
3596 	,
3592 	,
3588 	,
3584 	,
3579 	,
3575 	,
3570 	,
3565 	,
3559 	,
3554 	,
3548 	,
3542 	,
3536 	,
3529 	,
3522 	,
3515 	,
3508 	,
3500 	,
3493 	,
3484 	,
3476 	,
3467 	,
3458 	,
3448 	,
3438 	,
3428 	,
3417 	,
3406 	,
3394 	,
3382 	,
3370 	,
3357 	,
3344 	,
3330 	,
3316 	,
3301 	,
3286 	,
3270 	,
3253 	,
3237 	,
3219 	,
3201 	,
3182 	,
3163 	,
3143 	,
3123 	,
3101 	,
3079 	,
3057 	,
3033 	,
3009 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 	,
3000 
};






